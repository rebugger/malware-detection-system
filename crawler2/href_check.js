var path = require('path')
var fs = require('fs')
var request = require("request");
var client = require('cheerio-httpcli');

// var dataPath = path.join(__dirname, '../pattern/pattern.json');
// var list = JSON.parse(fs.readFileSync(dataPath, 'utf8'));
// var list = fs.readFileSync(dataPath, 'utf8');

module.exports = (list) => {
    // data => script, href 태그 리스트를 모두 요청 받으면 실행하기 위한 체크섬
    console.log('href_check crawler2 실행 전 데이타 값 확인 : %s', list)
    
    var cList = []; 
    cList = list.Patt_list
    var cLength = list.Patt_list.length

    console.log('crawler2 lenght :',cList.length)
    console.log('패턴 체크 : ', cLength)




    ///여기서부터 시작하면 된당 !!!
    function WF_crawler(url) {
        // var obj = {
        //     Flist : []
        // }
        client.fetch(url,function(err, $, res){
            var result = [];
            var src;
            if(err) throw err;
            else{
                $('script').each(function(idx, data){
                    var src = $(this).attr('src');

                    if(typeof(src) !== 'undefined' && src !== 'javascript:;' && src !== '#'){
                        var itUrl = src                        
                        // if(itUrl.indexOf('h',1)){
                        //     console.log('dmd? : ', itUrl)
                        // }
                        if(idx === 100){
                            return false;
                            console.log('href crawler 중지;')
                        }
                        if(idx === 1){
                            result.push(itUrl);
                        }
                        else{
                            if(result.indexOf(itUrl) > -1){
                            }
                            else{
                                result.push(itUrl)  
                            }
                            // console.log(result.length)
                        }
                    }
                })
                // WF_IN_log_existsJson(result);
                WF_IN_log_foundJson(result) //데이터 저장
            }
            console.log('script 끝')
        })
    }
    
}


